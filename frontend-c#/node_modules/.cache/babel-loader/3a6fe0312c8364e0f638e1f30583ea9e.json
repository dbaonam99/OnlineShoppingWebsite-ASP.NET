{"ast":null,"code":"var _jsxFileName = \"/Users/namduong/Documents/dev/shop-project/frontend/src/components/admin/Dashboard/Main/DashboardMain.js\";\nimport React, { useEffect, useState } from 'react';\nimport '../../../../App.css';\nimport '../../../../Styles/Dashboard.css';\nimport { faFileInvoice, faMoneyBillWave, faStar, faTshirt, faUser } from '@fortawesome/free-solid-svg-icons';\nimport DashboardTotalCount from './DashboardTotalCount';\nimport DashboardLocation from './DashboardLocation';\nimport DashboardTopFive from './DashboardTopFive';\nimport DashboardRecentReview from './DashboardRecentReview';\nimport axios from 'axios';\nimport DashboardRecentOrders from './DashboardRecentOrders';\nimport DashboardChart from './DashboardChart';\nexport default function DashboardMain() {\n  const [products, setProducts] = useState([]);\n  const [order, setOrder] = useState([]);\n  const [user, setUser] = useState([]);\n  const [topCustomer, setTopCusomer] = useState([]);\n  const [topProductSales, setTopProductSales] = useState([]);\n  const [totalIncome, setTotalIncome] = useState(0);\n  const [totalSale, setTotalSale] = useState(0);\n  useEffect(() => {\n    axios.get(`http://localhost:4000/products`).then(res => {\n      setProducts(res.data);\n    });\n    axios.get(`http://localhost:4000/users/list`).then(res => {\n      setUser(res.data);\n    });\n    axios.get(`http://localhost:4000/order`).then(res => {\n      setOrder(res.data);\n      const topCustomer2 = Object.values(res.data.reduce((a, {\n        orderEmail,\n        orderName,\n        orderTotal,\n        orderAvatar\n      }) => {\n        a[orderEmail] = a[orderEmail] || {\n          orderEmail,\n          orderName,\n          orderAvatar,\n          orderTotal,\n          count: 0\n        };\n        a[orderEmail].count++;\n        return a;\n      }, Object.create(null)));\n      topCustomer2.sort((a, b) => b.count - a.count);\n      setTopCusomer(topCustomer2);\n      var totalIncome = 0;\n      var totalSale = 0;\n\n      for (let i in res.data) {\n        for (let j in res.data[i].orderList) {\n          totalSale += res.data[i].orderList[j].amount;\n        }\n\n        totalIncome += res.data[i].orderTotal;\n      }\n\n      setTotalSale(totalSale);\n      setTotalIncome(totalIncome);\n    });\n  }, []);\n  const [recentOrder, setRecentOrder] = useState([]);\n  useEffect(() => {\n    var allProductSales = [];\n    const recentOrder2 = [...order];\n\n    if (order.length > 0) {\n      recentOrder2.sort(function (a, b) {\n        return new Date(b.orderDate) - new Date(a.orderDate);\n      });\n    }\n\n    setRecentOrder(recentOrder2.slice(0, 5));\n\n    for (let i in order) {\n      for (let j in order[i].orderList) {\n        for (let k in products) {\n          if (products[k]._id === order[i].orderList[j].id) {\n            allProductSales.push(products[k]);\n          }\n        }\n      }\n    }\n\n    const topProductSales2 = Object.values(allProductSales.reduce((a, {\n      _id,\n      productName,\n      productImg\n    }) => {\n      a[_id] = a[_id] || {\n        _id,\n        productName,\n        productImg,\n        count: 0\n      };\n      a[_id].count++;\n      return a;\n    }, Object.create(null)));\n    topProductSales2.sort((a, b) => b.count - a.count);\n    setTopProductSales(topProductSales2);\n  }, [order, products]);\n  const totalCount = [{\n    id: 1,\n    title: \"Total orders\",\n    count: order.length,\n    percent: 12,\n    color: \"orange\",\n    icon: faFileInvoice\n  }, {\n    id: 2,\n    title: \"Total sales\",\n    count: `${totalSale}`,\n    percent: 20,\n    color: \"pink\",\n    icon: faTshirt\n  }, {\n    id: 3,\n    title: \"Income\",\n    count: `${totalIncome}đ`,\n    percent: 30,\n    color: \"green\",\n    icon: faMoneyBillWave\n  }, {\n    id: 4,\n    title: \"Users\",\n    count: user.length,\n    percent: 5,\n    color: \"lightblue\",\n    icon: faUser\n  }];\n  const recentVote = [];\n\n  if (products.length > 0) {\n    for (let i = 0; i < products.length; i++) {\n      const productVote = products[i].productVote;\n\n      for (let j = 0; j < productVote.length; j++) {\n        const newRatingDate = new Date(productVote[j].ratingDate);\n        productVote[j].productName = products[i].productName;\n\n        if (newRatingDate.getDate() === new Date().getDate()) {\n          let hours = newRatingDate.getHours().toString();\n          let minutes = newRatingDate.getMinutes().toString();\n\n          if (hours < 10) {\n            hours = \"0\" + hours;\n          }\n\n          if (minutes < 10) {\n            minutes = \"0\" + minutes;\n          }\n\n          productVote[j].ratingHours = hours;\n          productVote[j].ratingMinutes = minutes;\n        } else {\n          let days = newRatingDate.getDay().toString();\n          let months = newRatingDate.getMonth().toString();\n\n          if (days < 10) {\n            days = \"0\" + days;\n          }\n\n          if (months < 10) {\n            months = \"0\" + months;\n          }\n\n          productVote[j].ratingDays = days;\n          productVote[j].ratingMonths = months;\n          productVote[j].ratingYears = newRatingDate.getFullYear().toString();\n        }\n\n        recentVote.push(productVote[j]);\n      }\n    }\n  }\n\n  if (recentVote) {\n    recentVote.sort(function (a, b) {\n      return new Date(b.ratingDate) - new Date(a.ratingDate);\n    });\n  }\n\n  const topRecentVote = recentVote.splice(0, 5);\n  console.log(recentOrder);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dashboard-main\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row flex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 13\n    }\n  }, totalCount.map((item, index) => {\n    return /*#__PURE__*/React.createElement(DashboardTotalCount, {\n      key: index,\n      icon: item.icon,\n      title: item.title,\n      count: item.count,\n      percent: item.percent,\n      color: item.color,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 25\n      }\n    });\n  })), /*#__PURE__*/React.createElement(DashboardLocation, {\n    order: order,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row flex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(DashboardTopFive, {\n    icon: faUser,\n    title: \"Top customers by orders\",\n    color: \"lightblue\",\n    data: topCustomer,\n    table: [{\n      title: 'User name'\n    }, {\n      title: 'Total orders'\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(DashboardTopFive, {\n    icon: faTshirt,\n    title: \"Top products by selling\",\n    color: \"pink\",\n    data: topProductSales,\n    table: [{\n      title: 'Product name'\n    }, {\n      title: 'Total sales'\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row flex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(DashboardRecentReview, {\n    icon: faStar,\n    title: \"Recent Review\",\n    color: \"orange\",\n    topRecentVote: topRecentVote,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(DashboardRecentOrders // recent orders\n  , {\n    icon: faFileInvoice,\n    title: \"Recent Order\",\n    color: \"green\",\n    recentOrder: recentOrder,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row flex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(DashboardChart, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 17\n    }\n  })));\n}","map":{"version":3,"sources":["/Users/namduong/Documents/dev/shop-project/frontend/src/components/admin/Dashboard/Main/DashboardMain.js"],"names":["React","useEffect","useState","faFileInvoice","faMoneyBillWave","faStar","faTshirt","faUser","DashboardTotalCount","DashboardLocation","DashboardTopFive","DashboardRecentReview","axios","DashboardRecentOrders","DashboardChart","DashboardMain","products","setProducts","order","setOrder","user","setUser","topCustomer","setTopCusomer","topProductSales","setTopProductSales","totalIncome","setTotalIncome","totalSale","setTotalSale","get","then","res","data","topCustomer2","Object","values","reduce","a","orderEmail","orderName","orderTotal","orderAvatar","count","create","sort","b","i","j","orderList","amount","recentOrder","setRecentOrder","allProductSales","recentOrder2","length","Date","orderDate","slice","k","_id","id","push","topProductSales2","productName","productImg","totalCount","title","percent","color","icon","recentVote","productVote","newRatingDate","ratingDate","getDate","hours","getHours","toString","minutes","getMinutes","ratingHours","ratingMinutes","days","getDay","months","getMonth","ratingDays","ratingMonths","ratingYears","getFullYear","topRecentVote","splice","console","log","map","item","index"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport '../../../../App.css'\nimport '../../../../Styles/Dashboard.css'\nimport { faFileInvoice, faMoneyBillWave, faStar, faTshirt, faUser } from '@fortawesome/free-solid-svg-icons'\nimport DashboardTotalCount from './DashboardTotalCount'\nimport DashboardLocation from './DashboardLocation'\nimport DashboardTopFive from './DashboardTopFive'\nimport DashboardRecentReview from './DashboardRecentReview'\nimport axios from 'axios'\nimport DashboardRecentOrders from './DashboardRecentOrders'\nimport DashboardChart from './DashboardChart'\n\nexport default function DashboardMain() {\n\n    const [products, setProducts] = useState([]);\n    const [order, setOrder] = useState([]);\n    const [user, setUser] = useState([]);\n    const [topCustomer, setTopCusomer] = useState([]);\n    const [topProductSales, setTopProductSales] = useState([]);\n    const [totalIncome, setTotalIncome] = useState(0);\n    const [totalSale, setTotalSale] = useState(0);\n\n    useEffect(()=>{\n        axios.get(`http://localhost:4000/products`)\n            .then(res => {\n                setProducts(res.data)\n            }\n        )\n        axios.get(`http://localhost:4000/users/list`)\n            .then(res => {\n                setUser(res.data)\n            }\n        )\n        axios.get(`http://localhost:4000/order`)\n            .then(res => {\n                setOrder(res.data)\n                const topCustomer2 = Object.values(res.data.reduce((a, {orderEmail, orderName, orderTotal, orderAvatar}) => {\n                    a[orderEmail] = a[orderEmail] || {orderEmail, orderName, orderAvatar, orderTotal, count: 0};\n                    a[orderEmail].count++;\n                    return a;\n                }, Object.create(null)));\n                topCustomer2.sort((a,b) =>  b.count - a.count)\n                setTopCusomer(topCustomer2)\n\n                var totalIncome = 0;\n                var totalSale = 0;\n                for(let i in res.data) {\n                    for(let j in res.data[i].orderList) {\n                        totalSale += res.data[i].orderList[j].amount\n                    }\n                    totalIncome += res.data[i].orderTotal\n                }\n                setTotalSale(totalSale)\n                setTotalIncome(totalIncome)\n            }\n        )\n    }, [])\n\n    const [recentOrder, setRecentOrder] = useState([])\n\n    useEffect(()=>{\n        var allProductSales = []\n\n        const recentOrder2 = [...order]\n        if (order.length > 0) {\n            recentOrder2.sort(function(a,b){\n                return new Date(b.orderDate) - new Date(a.orderDate);\n            });\n        }\n        setRecentOrder(recentOrder2.slice(0,5))\n\n        for (let i in order) {\n            for (let j in order[i].orderList) {\n                for (let k in products) {\n                    if (products[k]._id === order[i].orderList[j].id) {\n                        allProductSales.push(products[k])\n                    }\n                }\n            }\n        }\n        const topProductSales2 = Object.values(allProductSales.reduce((a, {_id, productName, productImg}) => {\n            a[_id] = a[_id] || {_id, productName, productImg, count: 0};\n            a[_id].count++;\n            return a;\n        }, Object.create(null)));\n        \n        topProductSales2.sort((a,b) =>  b.count - a.count)\n        setTopProductSales(topProductSales2)\n    },[order, products])\n\n    const totalCount = [\n        {\n            id: 1,\n            title: \"Total orders\",\n            count: order.length,\n            percent: 12,\n            color: \"orange\",\n            icon: faFileInvoice\n        },\n        {\n            id: 2,\n            title: \"Total sales\",\n            count: `${totalSale}`,\n            percent: 20,\n            color: \"pink\",\n            icon: faTshirt\n        },\n        {\n            id: 3,\n            title: \"Income\",\n            count: `${totalIncome}đ`,\n            percent: 30,\n            color: \"green\",\n            icon: faMoneyBillWave\n        },\n        {\n            id: 4,\n            title: \"Users\",\n            count: user.length,\n            percent: 5,\n            color: \"lightblue\",\n            icon: faUser\n        },\n    ]\n\n    const recentVote = [];\n    if (products.length > 0) {\n        for (let i = 0; i < products.length; i++) {\n            const productVote = products[i].productVote;\n            for (let j = 0; j < productVote.length; j++) {\n                const newRatingDate = new Date(productVote[j].ratingDate);\n                productVote[j].productName = products[i].productName;\n                if (newRatingDate.getDate() === new Date().getDate()) {\n                    let hours = newRatingDate.getHours().toString();\n                    let minutes = newRatingDate.getMinutes().toString();\n                    if (hours < 10) {\n                        hours = \"0\" + hours\n                    }\n                    if (minutes < 10) {\n                        minutes = \"0\" + minutes\n                    }\n                    productVote[j].ratingHours = hours;\n                    productVote[j].ratingMinutes = minutes;\n                } else {\n                    let days = newRatingDate.getDay().toString();\n                    let months = newRatingDate.getMonth().toString();\n                    if (days < 10) {\n                        days = \"0\" + days\n                    }\n                    if (months < 10) {\n                        months = \"0\" + months\n                    }\n                    productVote[j].ratingDays = days;\n                    productVote[j].ratingMonths = months;\n                    productVote[j].ratingYears = newRatingDate.getFullYear().toString();\n                }\n                recentVote.push(productVote[j])\n            }\n        }\n    }\n\n    if (recentVote) {\n        recentVote.sort(function(a,b){\n            return new Date(b.ratingDate) - new Date(a.ratingDate);\n        });\n    }\n\n    const topRecentVote = recentVote.splice(0,5)\n    console.log(recentOrder)\n\n    return (\n        <div className=\"dashboard-main\">\n            <div className=\"row flex\">\n                { totalCount.map((item, index)=> {\n                    return (\n                        <DashboardTotalCount\n                            key = {index}\n                            icon = {item.icon}\n                            title = {item.title}\n                            count = {item.count}\n                            percent = {item.percent}\n                            color = {item.color}\n                        />\n                    )\n                })}\n            </div>\n            <DashboardLocation\n                order={order}\n            />\n            <div className=\"row flex\">\n                <DashboardTopFive\n                    icon = {faUser}\n                    title = \"Top customers by orders\"\n                    color = \"lightblue\"\n                    data = {topCustomer}\n                    table = {[\n                        {\n                            title: 'User name'\n                        },\n                        {\n                            title: 'Total orders'\n                        },\n                    ]}\n                />\n                <DashboardTopFive\n                    icon = {faTshirt}\n                    title = \"Top products by selling\"\n                    color = \"pink\"\n                    data = {topProductSales}\n                    table = {[\n                        {\n                            title: 'Product name'\n                        },\n                        {\n                            title: 'Total sales'\n                        },\n                    ]}\n                />\n            </div>\n            <div className=\"row flex\">\n                <DashboardRecentReview\n                    icon = {faStar}\n                    title = \"Recent Review\"\n                    color = \"orange\"\n                    topRecentVote = {topRecentVote}\n                />\n                <DashboardRecentOrders // recent orders\n                    icon = {faFileInvoice}\n                    title = \"Recent Order\"\n                    color = \"green\"\n                    recentOrder = {recentOrder}\n                />\n            </div>\n            <div className=\"row flex\">\n                <DashboardChart/>\n            </div>\n        </div>\n    )\n}"]},"metadata":{},"sourceType":"module"}